<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Auth 组件 - goal-web</title><meta name="description" content="Goal-web/auth goal-web/auth goal 框架的用户认证组件，你可以在 http、websocket 或者其他环境使用。 $ go get github.com/goal-web/auth 使用 - usage goal 的脚手架自带了绝大多数开发一个 web 应用的所需要的功能和组件，当然这也包括了认证组件。一般情况下，我们只需要在 .env 修改自己的认证配置即可，比如 jwt 驱动的 secret、session 驱动的 session_key。 默认情况下，config/auth.go 配置文件像下面那样，默认添加了 jwt、session 两个守卫配置 package config import ( &quot;github.com/goal-web/auth&quot; &quot;github.com/goal-web/contracts&quot; &quot;github.com/goal-web/example/models&quot; &quot;github.com/golang-jwt/jwt&quot; ) func init() { configs[&quot;auth&quot;] = func(env contracts.Env) interface{}&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://goal-web.com/auth-zu-jian.html"><link rel="alternate" type="application/atom+xml" href="https://goal-web.com/feed.xml"><link rel="alternate" type="application/json" href="https://goal-web.com/feed.json"><meta property="og:title" content="Auth 组件"><meta property="og:site_name" content="goal-web"><meta property="og:description" content="Goal-web/auth goal-web/auth goal 框架的用户认证组件，你可以在 http、websocket 或者其他环境使用。 $ go get github.com/goal-web/auth 使用 - usage goal 的脚手架自带了绝大多数开发一个 web 应用的所需要的功能和组件，当然这也包括了认证组件。一般情况下，我们只需要在 .env 修改自己的认证配置即可，比如 jwt 驱动的 secret、session 驱动的 session_key。 默认情况下，config/auth.go 配置文件像下面那样，默认添加了 jwt、session 两个守卫配置 package config import ( &quot;github.com/goal-web/auth&quot; &quot;github.com/goal-web/contracts&quot; &quot;github.com/goal-web/example/models&quot; &quot;github.com/golang-jwt/jwt&quot; ) func init() { configs[&quot;auth&quot;] = func(env contracts.Env) interface{}&hellip;"><meta property="og:url" content="https://goal-web.com/auth-zu-jian.html"><meta property="og:type" content="article"><link rel="stylesheet" href="https://goal-web.com/assets/css/style.css?v=7c7ed2e3e90182a09465f36ea7129616"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://goal-web.com/auth-zu-jian.html"},"headline":"Auth 组件","datePublished":"2022-03-10T23:59","dateModified":"2022-03-11T00:00","description":"Goal-web/auth goal-web/auth goal 框架的用户认证组件，你可以在 http、websocket 或者其他环境使用。 $ go get github.com/goal-web/auth 使用 - usage goal 的脚手架自带了绝大多数开发一个 web 应用的所需要的功能和组件，当然这也包括了认证组件。一般情况下，我们只需要在 .env 修改自己的认证配置即可，比如 jwt 驱动的 secret、session 驱动的 session_key。 默认情况下，config/auth.go 配置文件像下面那样，默认添加了 jwt、session 两个守卫配置 package config import ( &quot;github.com/goal-web/auth&quot; &quot;github.com/goal-web/contracts&quot; &quot;github.com/goal-web/example/models&quot; &quot;github.com/golang-jwt/jwt&quot; ) func init() { configs[&quot;auth&quot;] = func(env contracts.Env) interface{}&hellip;","author":{"@type":"Person","name":"qbhy","url":"https://goal-web.com/zuo-zhe/qbhy/"},"publisher":{"@type":"Organization","name":"qbhy"}}</script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://goal-web.com/">goal-web</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://github.com/goal-web/goal" title="github" target="_blank" rel="_blank">github仓库</a></li><li><a href="https://goal-web.com/goal-kuai-su-kai-shi.html" target="_self">快速开始</a></li><li><a href="https://goal-web.com/goal-features.html" target="_self">组件</a></li><li><a href="https://goal-web.com/join-goal.html" target="_self">加入我们</a></li></ul></nav></header><main><article class="post"><div class="hero"><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2022-03-10T23:59">三月 10, 2022</time></div><h1>Auth 组件</h1><div class="post__meta post__meta--author"><a href="https://goal-web.com/zuo-zhe/qbhy/" class="feed__author">qbhy</a></div></div></header></div><div class="wrapper post__entry"><h1 id="goal-webauth">Goal-web/auth</h1><p><a href="https://github.com/goal-web/auth">goal-web/auth</a><br>goal 框架的用户认证组件，你可以在 <code>http</code>、<code>websocket</code> 或者其他环境使用。</p><h2 id="安装---install">安装 - install</h2><pre><code class="language-bash">$ go get github.com/goal-web/auth
</code></pre><h2 id="使用---usage">使用 - usage</h2><p>goal 的脚手架自带了绝大多数开发一个 web 应用的所需要的功能和组件，当然这也包括了认证组件。一般情况下，我们只需要在 .env 修改自己的认证配置即可，比如 <code>jwt</code> 驱动的 secret、<code>session</code> 驱动的 session_key。</p><h3 id="配置---config">配置 - config</h3><p>默认情况下，<code>config/auth.go</code> 配置文件像下面那样，默认添加了 <code>jwt</code>、<code>session</code> 两个守卫配置</p><pre><code class="language-go">package config

import (
    &quot;github.com/goal-web/auth&quot;
    &quot;github.com/goal-web/contracts&quot;
    &quot;github.com/goal-web/example/models&quot;
    &quot;github.com/golang-jwt/jwt&quot;
)

func init() {
    configs[&quot;auth&quot;] = func(env contracts.Env) interface{} {
        return auth.Config{
            Defaults: struct {
                Guard string
                User  string
            }{
                Guard: env.StringOption(&quot;auth.default&quot;, &quot;jwt&quot;), // 默认守卫
                User:  env.StringOption(&quot;auth.user&quot;, &quot;db&quot;), // 默认用户提供者
            },
            Guards: map[string]contracts.Fields{
                &quot;jwt&quot;: { // 守卫名称
                    &quot;driver&quot;:   &quot;jwt&quot;, // 驱动,目前支持jwt、session
                    &quot;secret&quot;:   env.GetString(&quot;auth.jwt.secret&quot;), // jwt 签名所需的 secret，不同的守卫建议不同的secret
                    &quot;method&quot;:   jwt.SigningMethodHS256, // jwt 签名方法
                    &quot;lifetime&quot;: 60 * 60 * 24, // token有效时长，单位：秒
                    &quot;provider&quot;: &quot;db&quot;, // 用户提供者名
                },
                &quot;session&quot;: { // 守卫名称
                    &quot;driver&quot;:      &quot;session&quot;, // 驱动名
                    &quot;provider&quot;:    &quot;db&quot;, // 用户提供者名
                    // session驱动所需的参数，如果应用需要配置多个session驱动的守卫，那么需要配置不一样的 session_key
                    &quot;session_key&quot;: env.StringOption(&quot;auth.session.key&quot;, &quot;auth_session&quot;), 
                },
            },
            Users: map[string]contracts.Fields{ // 用户提供者，目前只支持 db
                &quot;db&quot;: { // 用户提供者名称
                    &quot;driver&quot;: &quot;db&quot;, // 驱动名称
                    &quot;model&quot;:  models.UserModel, // 用户模型
                },
            },
        }
    }
}
</code></pre><p><code>.env</code> 的数据库相关配置</p><pre><code class="language-bash">auth.jwt.secret=jwt_secret
auth.default=jwt
</code></pre><h3 id="定义模型---define-a-model">定义模型 - define a model</h3><p><code>app/models/user.go</code> 文件</p><pre><code class="language-go">package models

import (
    &quot;github.com/goal-web/database/table&quot;
    &quot;github.com/goal-web/supports/class&quot;
)

var (
    UserModel = table.NewModel(class.Make(new(User)), &quot;users&quot;)
)

func UserQuery() *table.Table {
    return table.FromModel(UserModel)
}

type User struct {
    Id       string `json:&quot;id&quot;`
    NickName string `json:&quot;name&quot;`
}

// GetId 实现了 contracts.Authenticatable 接口，此方法必不可少
func (u User) GetId() string {
    return u.Id
}
</code></pre><h3 id="用法---method-of-use">用法 - method of use</h3><pre><code class="language-go">package controllers

import (
    &quot;github.com/goal-web/contracts&quot;
    &quot;github.com/goal-web/example/models&quot;
)

func LoginExample(guard contracts.Guard) contracts.Fields {
    //  这是伪代码
    user := models.UserQuery().First().(models.User)

    return contracts.Fields{
        &quot;token&quot;: guard.Login(user), // jwt 返回 token，session 返回 true
    }
}

func GetCurrentUser(guard contracts.Guard) interface{} {
    return contracts.Fields{
        &quot;user&quot;: guard.User(), // 已登录返回用户模型，否则返回 nil
    }
}
</code></pre><h3 id="使用中间件">使用中间件</h3><pre><code class="language-go">package routes

import (
    &quot;github.com/goal-web/auth&quot;
    &quot;github.com/goal-web/contracts&quot;
    &quot;github.com/goal-web/example/app/http/controllers&quot;
    &quot;github.com/goal-web/session&quot;
)

func ApiRoutes(router contracts.Router) {
    
    v1 := router.Group(&quot;&quot;, session.StartSession)
    
    // 直接应用在路由上
    v1.Get(&quot;/myself&quot;, controllers.GetCurrentUser, auth.Guard(&quot;jwt&quot;))
    
    // 应用在路由组上
    authRouter := v1.Group(&quot;&quot;, auth.Guard(&quot;jwt&quot;))
    authRouter.Get(&quot;/myself&quot;, controllers.GetCurrentUser, auth.Guard(&quot;jwt&quot;))

}
</code></pre><h3 id="守卫api---guard-api">守卫API - guard api</h3><pre><code class="language-go">type Guard interface {
    Once(user Authenticatable)
    User() Authenticatable
    GetId() string
    Check() bool
    Guest() bool
    Login(user Authenticatable) interface{}
}
</code></pre><h3 id="扩展守卫和用户提供者---extension">扩展守卫和用户提供者 - extension</h3><p>这部分内容比较多，这里暂时不展开讲，后面会专门录视频介绍，欢迎大家点赞订阅</p><h3 id="在-goal-之外的框架使用---use-in-frameworks-other-than-goal">在 goal 之外的框架使用 - use in frameworks other than goal</h3><p>这部分内容比较多，这里暂时不展开讲，后面会专门录视频介绍，欢迎大家点赞订阅</p><p><a href="https://github.com/goal-web/goal">goal-web</a><br><a href="https://github.com/goal-web/auth">goal-web/auth</a><br><a href="mailto:&#113;&#x62;&#104;&#121;&#48;&#x37;&#49;&#x35;&#x40;&#113;&#113;&#46;&#x63;&#x6f;&#x6d;">&#113;&#x62;&#104;&#121;&#48;&#x37;&#49;&#x35;&#x40;&#113;&#113;&#46;&#x63;&#x6f;&#x6d;</a></p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on 三月 11, 2022</p><ul class="post__tag"><li><a href="https://goal-web.com/biao-qian/goalzu-jian/">goal组件</a></li></ul><div class="post__share"></div><div class="post__bio bio"><div class="bio__info"><h3 class="bio__name"><a href="https://goal-web.com/zuo-zhe/qbhy/" rel="author">qbhy</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://goal-web.com/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://goal-web.com/goal-ying-yong-mu-lu-jie-gou.html" class="post__nav-link" rel="prev"><span>Previous</span> Goal 应用目录结构</a></div><div class="post__nav-next"><a href="https://goal-web.com/querybuilder-cha-xun-gou-zao-qi-zu-jian.html" class="post__nav-link" rel="next"><span>Next</span> QueryBuilder - 查询构造器组件 </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://goal-web.com/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav></main><footer class="footer"><div class="footer__social"></div><div class="footer__copyright"><p>Powered by Publii</p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://goal-web.com/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://goal-web.com/assets/js/scripts.min.js?v=6ca8b60e6534a3888de1205e82df8528"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>